<!doctype html>
<html lang="ko">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>RES302</title>
	<link rel="stylesheet" href="assets/style.css" />
</head>
<body>
	<!-- 추가: 우측 상단 고정 Support 링크 -->
	<a class="top-right-support" href="/support/" title="지원 페이지 열기" aria-label="지원 페이지">Support</a>
	<!-- 추가: 우측 상단 Intro MP4 링크 -->
	<a class="top-right-intro" href="/support/intro.mp4" target="_blank" rel="noopener noreferrer" title="소개 영상 열기" aria-label="소개 영상">Intro</a>
	<!-- 추가: 우측 상단 presentation.pdf 링크 -->
	<a class="top-right-doc" href="/support/presentation.pdf" target="_blank" rel="noopener noreferrer" title="프레젠테이션 PDF 열기" aria-label="프레젠테이션 PDF">Presentation</a>
	<!-- 변경: 로그인/로그아웃 버튼을 위한 동적 컨테이너에 스타일 클래스 추가 -->
	<div id="auth-container" class="auth-widget"></div>

	<main class="container" role="main">
		<!-- 중앙 정렬된 로고 + 간단 설명 -->
		<div class="brand" role="banner">
			<img class="logo" src="assets/images/logo.png" alt="RES302">
			<p class="lead" style="margin-top:0">간단하고 빠른 단축 URL 생성 서비스</p>
		</div>

		<!-- 중앙 검색(단축) 박스 -->
		<section aria-labelledby="shorten-heading">
			<h2 id="shorten-heading" style="position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden;">단축 URL 생성</h2>
			<form class="search-box" onsubmit="event.preventDefault(); document.getElementById('shorten-btn').click();">
				<input id="url-input" type="url" placeholder="원본 URL을 입력하세요 (예: https://example.com)" aria-label="원본 URL" />
				<button id="shorten-btn" type="button">단축 생성</button>
			</form>

			<!-- 추가: 로그인 시 커스텀 코드 입력 필드 -->
			<div id="alias-input-container" class="search-box alias-box hidden">
				<input id="alias-input" type="text" placeholder="커스텀 코드 (선택 사항)" aria-label="커스텀 코드" style="flex:1;border:none;outline:none;padding:8px;background:transparent;">
			</div>

			<!-- 결과는 입력폼 영역이 대체하여 표시됩니다 (result-box 삭제) -->
			<p id="custom-code-note" class="note" style="text-align:center;margin:8px 0 0">비회원은 커스텀 코드를 제공할 수 없습니다. 커스텀 코드가 필요하면 회원으로 로그인하세요.</p>
			<div id="msg" class="status" role="status" aria-live="polite" style="text-align:center"></div>
		</section>
	</main>

	<!-- 추가: API 키 모달 -->
	<div id="api-key-modal" class="modal-overlay hidden">
		<div class="modal-content">
			<button class="modal-close-btn" id="modal-close-btn">&times;</button>
			<h2>내 계정 정보</h2>
			<p>아래 정보를 사용하여 API를 호출하거나 계정을 식별할 수 있습니다.</p>

			<div class="api-key-section">
				<h3>API 키</h3>
				<div class="api-key-display">
					<code id="display-api-key"></code>
					<button id="copy-api-key-btn" class="btn primary small">복사</button>
				</div>
			</div>

			<div class="user-id-section">
				<h3>고유 사용자 ID</h3>
				<div class="api-key-display">
					<code id="display-unique-user-id"></code>
					<button id="copy-user-id-btn" class="btn primary small">복사</button>
				</div>
			</div>
			
			<p class="modal-message" id="modal-message"></p>
		</div>
	</div>

	<script src="/member/auth.js" defer></script>
	<script src="assets/app.js" defer></script>
	<script>
		// 추가: 로그인 상태에 따라 UI를 동적으로 변경하는 스크립트
		document.addEventListener('DOMContentLoaded', () => {
			const authContainer = document.getElementById('auth-container');
			const user = window.getCurrentUser();

			if (user) {
				// 로그인된 경우: 프로필 사진과 로그아웃 버튼 표시
				const userName = user.name || 'User profile';
				authContainer.innerHTML = `
					${user.picture ? `<img src="${user.picture}" alt="${userName}" class="profile-picture clickable" id="profile-picture">` : ''}
					<button id="logout-btn" class="auth-button" type="button">Logout</button>
				`;
				document.getElementById('logout-btn').addEventListener('click', () => {
					window.logout();
				});

				// 프로필 사진 클릭 시 API 키 모달 열기
				const profilePicture = document.getElementById('profile-picture');
				if (profilePicture) {
					profilePicture.addEventListener('click', () => {
						const apiKeyModal = document.getElementById('api-key-modal');
						const displayApiKey = document.getElementById('display-api-key');
						const displayUniqueUserId = document.getElementById('display-unique-user-id'); // 추가
						const modalMessage = document.getElementById('modal-message');
						
						displayApiKey.textContent = user.apiKey;
						displayUniqueUserId.textContent = user.uniqueUserId; // 추가
						modalMessage.textContent = ''; // 이전 메시지 초기화
						apiKeyModal.classList.remove('hidden');
					});
				}
			} else {
				// 로그아웃된 경우: 로그인 버튼 표시
				authContainer.innerHTML = `<a class="auth-button" href="/member/login.html">Login</a>`;
			}

			// 모달 닫기 버튼 이벤트
			document.getElementById('modal-close-btn').addEventListener('click', () => {
				document.getElementById('api-key-modal').classList.add('hidden');
			});

			// API 키 복사 버튼 이벤트
			document.getElementById('copy-api-key-btn').addEventListener('click', async () => {
				const apiKey = document.getElementById('display-api-key').textContent;
				const modalMessage = document.getElementById('modal-message');
				try {
					await navigator.clipboard.writeText(apiKey);
					modalMessage.textContent = 'API 키가 클립보드에 복사되었습니다.';
				} catch (err) {
					modalMessage.textContent = 'API 키 복사 실패.';
					console.error('Failed to copy API key:', err);
				}
			});

			// 고유 사용자 ID 복사 버튼 이벤트 추가
			document.getElementById('copy-user-id-btn').addEventListener('click', async () => {
				const uniqueUserId = document.getElementById('display-unique-user-id').textContent;
				const modalMessage = document.getElementById('modal-message');
				try {
					await navigator.clipboard.writeText(uniqueUserId);
					modalMessage.textContent = '고유 사용자 ID가 클립보드에 복사되었습니다.';
				} catch (err) {
					modalMessage.textContent = '고유 사용자 ID 복사 실패.';
					console.error('Failed to copy Unique User ID:', err);
				}
			});
		});
	</script>
 </body>
 </html>
